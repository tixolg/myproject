Docker — фреймворк с открытым исходным кодом для управления контейнерной виртуализацией.

CMD команда внутри контейнера, выполняемая после старта контейнера.
ENTRYPOINT команда в контейнере не подлежащая переопределению, кроме как из командной строки, при старте контейнера

Можно комбинировать ENTRYPOINT и CMD.
ENTRYPOINT  команда выолняемая при старте контейнера, имеющая приоритет перед CMD и имеющаю любую форму.
ENTRYPOINT ["/usr/sbin/nginx"]
CMD ["-h"]

В этом случае команда в ENTRYPOINT выполнится в любом случае, а команда в CMD выполнится, если не передано другой команды при запуске контейнера. Если требуется, вы все-таки можете перегрузить команду ENTRYPOINT с помощью флага --entrypoint.

WORKDIR установит рабочую директорию

USER Специфицирует пользователя, под которым должен быть запущен образ. Мы можем указать имя пользователя или UID и группу или GID.

VOLUME Инструкция VOLUME добавляет тома в образ. Хранилища можно расшаривать. VOLUME позволяет создавать точку монтирования.

ADD добавляет файлы или папки из нашего билд-окружения в образ, что полезно, например, при установке приложения, и умеет читать url

COPY отличается от ADD тем, что предназначена для копирования локальных файлов из билд-контекста и не поддерживает распаковки файлов.

EXPOSE в докерфайле комментарий про проброс портов для инженера. по факту ничего не делает.

Чтобы корректно настраивать образ, требуется писать команды через &&. иначе слои не будут знать что было выполнено ранее

Что такое Multi-stage builds, сначала создаёт некий х,и результат используешь для другого Y. Первый слой ставит зависимости, устанавливает например голанг, и потом удаляется ненужный хлам, далее паршет уже смо приложение. Позволяет оптимизировать сборку образов. Сделать контейнеры более «легкими», а также унифицировать процесс разработки, сборки и деплоя. Образ создастся только из последнего FROM на основании переменных первого контекста.

теги и закладки это одно и тоже

Нужно корректно прописывать требования, зависимости и распаковку архивов в корректное место
Когда файлы копируются с помощью COPY, разрешения сохраняются


RUN <unit tests> проверить сборку на корректность, в случае успеха запустится пустой образ

ENV говорит в образе какие переменные среды использовать, точнее версии стр 270

Проверить разные параметры
*docker inspect*

Посмотреть все процесссы на линуксе, вкл процессы контейнеров
*$ ps faux | less*

UID=0 is root, and has elevated privileges (имеет повышенные привелегии)

В любой момент к контейнеру можно подключиться с помощью команды docker exec -it с целью просмотреть логи или изменить настройки, детач оставит контейнер в рабочем состоянии: ctrl+p+q

check the status of container
*docker ps -l*

extract files from container
*docker cp <container_id>:/var/log/nginx/error.log .*

dump the entire filesystem of a container (выгрузит всю систему в архив)
*docker export <container_id> | tar tv*

docker run -d -P nginx
-d tells Docker to run the image in the background
-P tells Docker to make this service reachable from other computers.
(-P is the short version of --publish-all.)

установить порт вручную (хост-контейнер)
*docker run -d -p 8000:80 nginx*

узнать ip конкретного контейнера
*$ docker inspect --format '{{ .NetworkSettings.IPAddress }}' <yourContainerID>*

?Драйвер хоста стр 336
По умолчанию контейнер получает виртуальный eth0 интерфейс.
(В дополнение к собственному частному lo интерфейсу обратной петли.)
bridge (по умолчанию)
none
host
macvlan (?!)

посмотреть тип сети
*docker network ls*

создать сеть, где dev имя сети
*$ docker network create dev*

Docker Engine позволяет подключаться и отключаться во время работы контейнера через Docker API и через две команды Docker CLI:
*docker network connect <network> <container>
docker network disconnect <network> <container>*

ambassadors посолтипо nginx стр 390
код можно править в файле в вольюме прямо на хосте, а не внутри контейнера. Тома не копируют и не синхронизируют файлы между хостом и контейнером.

посмотреть вольюмы
*$ docker volume ls*

Внутри Dockerfile добавить хранилище
*VOLUME /uploads*
В командной строке
*$ docker run -d -v /uploads myapp*

Создать вольюм без контейнера (он не будет привязан к определённому пути)
*$ docker volume create webapps*

Запустить компоуз из директории
*docker-compose up*

Запустить все сборки где упоминается build
*docker-compose build*

Посмотреть статус заущенных контейнеров и инфу
*docker-compose ps*

Удалить контейнер. только rm ещё подтверждение спросит
docker-compose kill = docker-compose rm

Выключит контейнер, удалит сти и всёчто поднял. А опция -v грохет ещё и хранилища
*docker-compose down*

Переопределить имя проекта
*docker-compose -p*

?Системные процессы и tini 541

Починить переполненные чанки
*# btrfs filesys balance start -dusage=1 /var/lib/docker*

Docker Engine предлагает несколько флагов для ограничения использования памяти.
например: --memory 100m= 100 мегабайт.
--memory ограничивает объем физической памяти, используемой контейнером.
--memory-swap ограничивает общий объем (RAM + swap), используемый контейнером.

Каждый контейнер имеет относительный приоритет, используемый планировщиком Linux.
По умолчанию этот приоритет =1024.Пока загрузка ЦП не исчерпана, это не действует.
При максимальном использовании ЦП каждый контейнер получает циклы ЦП пропорционально своему относительному приоритету.

--cpus 0.1 означает 10% от одного процессора,
--cpus 1.0 означает 100% всего ЦП,
--cpus 10.0 означает 10 целых процессоров.

?Пространства имен PID? контрольные группы
стр 645
fork

on Kubernetes super-structure is called a pod. A pod is a group of containers (it could be a single container, too).These containers run together, on the same host. (A pod cannot straddle multiple hosts.) All the containers in a pod have the same IP address.

Домашнее задание
1. стр 218
Написать Dockerfiles для существующего приложения
The code is at: https://github.com/jpetazzo/wordsmith

2. стр 280
Измените Dockerfiles так, чтобы сборка стала мультистайдж.
Код находится по адресу: https://github.com/jpetazzo/wordsmith
Используйте иные теги для этих образов, чтобы сравнить их размеры в дальнейшем.
Какая разница в размерах между обычной и многоступенчатой ​​сборками?

3. стр 499
Let's write a Compose file for the wordsmith app!
The code is at: https://github.com/jpetazzo/wordsmith
